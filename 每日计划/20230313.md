## 结果
  - 写简历
  - 如何保证分布式系统一致性


STAR法则:S(情景(背景))：T(任务)+A(行动)+R(结果)
## 专业技能
熟练使用golang,有三年golang开发经验
熟悉redis/mysql数据库
了解操作系统和网络的基本知识
有分布式系统开发经验


## 工作经历
2020.05-2023.02 北京嘀嘀无限科技发展有限公司 智能中台/账单计价 高级软件开发工程师
1.负责业务中台核心系统的开发；
2.对突发事件快速响应处理，优化系统性能和提高代码质量；


## 项目经历
账单计价系统异地双活改造
【s】公司主导在不同地域建立数据中心(即redis集群)做灾备恢复，每个数据中心都正常接入线上流量(可读可写)
【t】账单实现按城市维度单元化(同一个key不在两机房双写)写入redis机房和切流
【a】流量染色和转发：上游http请求header中增加分流key字段(以订单起点城市为准)，中台inrouter层从header中解析城市信息，根据规则路由到相应机房的账单系统，账单系统实现单元化的写入redis操作(账单写入redis的key无城市信息，所以直接通过inroute层分流实现)。按城市维度的切流时，会出现中间状态(一部分机器已经切流完成一部分没有完成会出现同一个key双写两个机房的情况)，解决方案是账单会在key中携带城市信息给到redis，redis会根据城市信息禁写(禁止该key写入redis集群)来保证切流过程中不会发生双写
【r】城市群的分钟级切流，由切流引起的线上badcase数量级在个位数级别(重试后)

账单计价系统预估计价详情页解偶和降级
【s】乘客在打车前会先预估行程的总价，在调用账单预估接口获取总价的同时，也会返回预估计价详情信息页信息(携带文案)，但是该页面入口较深乘客一般不会点击查看
【t】将预估详情页和预估接口进行解偶并支持详情页降级操作
【a】将预估计价信息存入redis中并且写入过期时间(过期时间可降级)；当乘客点击预估详情页时，读取预估计价信息缓存并请求下游账单渲染系统返回计价详情页，如果缓存过期失效，则直接给用户展示总价兜底
【r】降低预估接口耗时最高40ms，高峰期降低了20ms-30ms；减少预估接口响应数据量，优化前247k，优化后133k，减少了46%

账单计价系统司乘费用抽成控制模块开发
【s】司乘独立定价引发了司乘抽成的不可控，为了将司乘费用抽成比例控制在一定范围内，账单计价系统设计并开发了抽成模块
【t】计算司乘抽成比例，如果超过限制，则额外给司机出一个奖励费用将抽成比例控制在阈值范围内
【a】不同业务场景会有不同的抽成阈值，所以首先会识别业务场景匹配对应的抽成阈值，获取乘客优惠券信息，计算司乘账单，计算给司机补足的金额。
【r】平均每天有70w+抽成控制金额补足给司机，做到司乘抽成比例的精准控制

帐单计价系统核心依赖redis降级兜底
【s】redis发生雪崩时，帐单计价系统对redis降级兜底策略可以保证打车流程不被影响，提升系统高可用性。
【t】帐单最核心的下游是redis集群，作用是会缓存累计走过的里程时长等信息。针对redis降级是通过上游透传必要数据来兜底的，为保证兜底逻辑清晰和可靠，兜底行程只保留里程和时长，对应的帐单也只包含了里程费和时长费两项，对司乘价格正确性有损。
【a】上游服务会透传起始坐标点和起始时间，redis集群返回行程数据为空时，帐单mock行程结构，根据起始坐标点和起始时间计算球面距离和时长写入行程结构，计算司乘帐单。
【r】系统可用性从3个9提升到了4个9

帐单渲染系统自助化改造
【s】账单渲染系统为用户提供打车费用详细信息。系统输入是司乘原始账单数据和订单信息，系统输出是带有文案的费用详细信息。产品运营在营销各种活动时会要求费项文案有所不同，为了适配频繁的文案新增修改并提高人效，于是设计并落地了文案自助化配置管理。
【t】提供可视化新增和修改服务。并且对每个费用文案在不同场景下提供个性化的动态渲染服务。
【a】文案收敛到配置平台。配置平台定时将文案推送到渲染系统所在的机器，系统定时加载文案到内存。在配置平台将每个费用项枚举出来并针对每个费用项配置不同文案策略同样通过定时加载的方式在系统中生效。
【r】自助率从0提升到80%


202303272124
账单计价系统详情页解偶降级
【项目背景】乘客预估行程总价时，接口同时会返回价格详情页信息，但该页面统计每天大约有2%乘客会点击查看
【项目目标】将预估价格详情页和预估接口进行解偶降级
【工作内容】将预估价格信息存入redis并且写入过期时间（过期时间可降级）；当乘客点击预估详情页时，读取预估价格信息缓存并请求下游账单渲染系统返回价格详情页。如果缓存过期失效，则直接给用户展示总价兜底
【项目收益】降低预估接口耗时最高40ms，高峰期降低了20ms-30ms；减少预估接口响应数据量，优化前247k，优化后133k，减少了46%

202303272124
账单计价系统异地双活改造
【项目背景】公司主导在不同地域建立数据中心(redis集群)做灾备恢复，保障系统高可用 
【项目目标】账单系统按城市维度单元化写入redis机房和切流 
【工作内容】流量染色和转发：上游http请求header中增加分流key字段(以订单起点城市为准)，中台inrouter层从header中解析 城市信息，根据规则路由到相应机房的账单系统，账单系统实现单元化的写入redis操作(账单写入redis的key无城市信息，所以 直接通过inroute层分流实现)。按城市维度的切流时，会出现中间状态(一部分机器已经切流完成一部分没有完成会出现同一个key双写两个机房的情况)，解决方案是账单会在key中携带城市信息给到redis，redis会根据城市信息禁写(禁止该key写入redis集群)来保证切流过程中不会发生双写 
【项目收益】异地双活提升了50%的系统可用性
  - 问题
    - 1. 禁写后写redis失败账单如何操作:上游重试
    - 2. redis双主同步 oplog是怎么保证增量复制的:记录每条数据时都会记录opInfo结构,opinfo中opid自增
